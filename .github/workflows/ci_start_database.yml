name: CI - Start Database

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  test-action:
    name: test-action/start-database
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        id: checkout
        uses: actions/checkout@v5

      ## simple test
      - name: start-database-1A
        uses: ./setup
        with:
          license: ${{ secrets.PROGRESS_CFG_LICENSE }}
      - name: start-database-1B
        shell: bash
        working-directory: start-database/test
        run: ant createDatabase
      - name: test-0
        shell: bash
        working-directory: start-database/test
        run: |
          ls -al target/db
      - name: start-database-1C
        uses: ./start-database
        continue-on-error: true
        with:
          path: start-database/test/target/db/sp2k
          port: 2000
          minport: 3000
          maxport: 3100
      - name: test-OB
        shell: bash
        working-directory: start-database/test
        run: |
          ps -ef
      - name: start-database-1D
        uses: ./run
        with:
          working-directory: start-database/test
          parameter-file: db.pf
          startup-procedure: customer_count.p
      - name: test-1
        shell: bash
        working-directory: start-database/test
        run: |
          ls -al
